<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>×§×¤×” ×˜××˜×™×¡ â€“ ×”×–×× ×” ××•× ×œ×™×™×Ÿ</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
:root{--brand:#11b6b8;--brand-700:#0b9395;--bg:#f7f9fc;--card:#ffffff;--ink:#0f172a;--muted:#475569;--border:#e2e8f0;--accent:#eefdfd}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font-family:Heebo,system-ui,Arial,sans-serif;line-height:1.55}
.appbar{position:sticky;top:0;z-index:20;background:var(--card);border-bottom:1px solid var(--border)}
.container{max-width:1200px;margin:0 auto;padding:14px}
.brandline{display:flex;align-items:center;gap:12px}
.logo{width:30px;height:30px;border-radius:8px;background:linear-gradient(135deg,var(--brand),#70e1e8)}
.title{font-weight:900;letter-spacing:.2px;font-size:clamp(20px,3.2vw,28px)}
.subtitle{color:var(--muted);font-size:13px}
.layout{display:grid;grid-template-columns:1fr;gap:16px;padding:10px}
@media(min-width:980px){.layout{grid-template-columns:1.7fr 1fr}}
.section{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 20px rgba(2,6,23,.06)}
.section-head{padding:10px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.section-title{margin:0;font-weight:900;font-size:20px}
.section-body{padding:12px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:8px}
.card{background:var(--card);border:1px solid var(--border);border-radius:10px;overflow:hidden;display:flex;flex-direction:column;height:100%}
.thumb{width:100%;height:64px;background:#f3f6f9;display:flex;align-items:center;justify-content:center}
.thumb img{width:100%;height:100%;object-fit:cover}
.card-body{padding:8px;display:grid;grid-template-rows:auto 1fr auto;gap:6px}
.card h3{margin:0;font-size:13px;line-height:1.2}
.card p{margin:0;color:var(--muted);font-size:11px}
.price{font-weight:800;font-size:13px}
.actions{display:flex;align-items:center;justify-content:space-between;min-height:38px}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;cursor:pointer;border-radius:10px;border:1px solid transparent;padding:7px 10px;font-weight:800;font-size:12px}
.btn.primary{background:var(--brand);color:#fff}.btn.primary:hover{background:var(--brand-700)}
.btn.ghost{background:#fff;border-color:var(--border);color:var(--ink)}
.btn.link{background:transparent;color:var(--brand);border:none}
.cart{position:sticky;top:70px}
.cart-items{max-height:460px;overflow:auto}
.cart-row{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;padding:10px 12px;border-bottom:1px dashed var(--border)}
.qty{display:flex;align-items:center;gap:6px}
.qty button{width:28px;height:28px;border-radius:8px;border:1px solid var(--border);background:#fff;font-weight:900;cursor:pointer}
.summary{padding:10px;border-top:1px solid var(--border)}
.line{display:flex;justify-content:space-between;margin:6px 0;font-size:14px}
.total{font-size:18px;font-weight:900}
dialog{border:none;border-radius:18px;padding:0;width:min(900px,96%);box-shadow:0 26px 48px rgba(2,6,23,.28)}
dialog::backdrop{background:rgba(2,6,23,.5)}
.modal-head{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.modal-body{padding:12px}
.group{margin:8px 0 14px}
.group h4{margin:0 0 8px;font-size:15px;font-weight:900}
.options{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
@media(min-width:720px){.options{grid-template-columns:repeat(3,1fr)}}
.opt{border:1px solid var(--border);border-radius:12px;padding:8px;display:flex;gap:8px;align-items:center;cursor:pointer;font-size:13px}
.opt input{margin:0 0 0 6px}
.opt.active{border-color:var(--brand);background:var(--accent);outline:2px solid rgba(14,165,166,.18)}
.helper{font-size:12px;color:var(--muted)}
form .field{display:grid;gap:6px}
input[type=text],input[type=email],input[type=tel],select,textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#fff;font-size:14px}
.two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.three{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
@media(max-width:640px){.two,.three{grid-template-columns:1fr}}
.hr{height:1px;background:var(--border);margin:8px 0}
.cat-head{font-weight:900;font-size:18px;margin:6px 0 8px}
.card.no-thumb .card-body{padding-top:10px}
.muted{color:var(--muted);font-size:12px}
</style>
</head>
<body>
<header class="appbar">
  <div class="container" style="display:flex;justify-content:space-between;align-items:center">
    <div class="brandline">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <div class="title">×§×¤×” ×˜××˜×™×¡ â€“ ×”×–×× ×” ××•× ×œ×™×™×Ÿ</div>
        <div class="subtitle">×ª×¤×¨×™×˜ ××§×¦×•×¢×™, ×‘×¨×•×¨ ×•×§×¨×™×</div>
      </div>
    </div>
    <button class="btn ghost" id="btnCheckoutHeader">×œ×ª×©×œ×•×</button>
  </div>
</header>

<main class="container layout">
  <section class="section">
    <div class="section-head">
      <h2 class="section-title">×ª×¤×¨×™×˜</h2>
      <div class="subtitle">×”×§×˜×’×•×¨×™×•×ª ××•×¦×’×•×ª ××—×ª ××ª×—×ª ×œ×©× ×™×™×”</div>
    </div>
    <div class="section-body">
      <div id="cat-salads">
        <div class="cat-head">×¡×œ×˜×™×</div>
        <div class="grid" id="grid-salads"></div>
      </div>

      <div id="cat-sandwiches" style="margin-top:14px">
        <div class="cat-head">×›×¨×™×›×™×</div>
        <div class="grid" id="grid-sandwiches"></div>
      </div>

      <div id="cat-desserts" style="margin-top:14px">
        <div class="cat-head">×§×™× ×•×—×™×</div>
        <div class="grid" id="grid-desserts"></div>
      </div>

      <div id="cat-drinks" style="margin-top:14px">
        <div class="cat-head">×©×ª×™×™×”</div>
        <div class="grid" id="grid-drinks"></div>
      </div>
    </div>
  </section>

  <aside class="section cart" aria-label="×¢×’×œ×”">
    <div class="section-head">
      <h2 class="section-title">×¢×’×œ×”</h2>
      <button class="btn link" id="btnClearCart">× ×§×”</button>
    </div>
    <div class="section-body">
      <div id="cartItems" class="cart-items"></div>
      <div class="summary">
        <div class="line"><span>×¡×›×•× ×‘×™× ×™×™×</span><strong id="subTotal">â‚ª0</strong></div>
        <div class="line"><span>××©×œ×•×—</span><strong id="deliveryFee">â‚ª0</strong></div>
        <div class="hr"></div>
        <div class="line total"><span>×¡×”"×›</span><strong id="grandTotal">â‚ª0</strong></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn primary" id="btnCheckout">×œ×ª×©×œ×•×</button>
          <button class="btn ghost" id="btnBuildSalad">×¡×œ×˜ ×‘×”×¨×›×‘×”</button>
        </div>
      </div>
    </div>
  </aside>
</main>

<!-- Salad Builder -->
<dialog id="dlgSalad" aria-label="×¡×œ×˜ ×‘×”×¨×›×‘×”">
  <div class="modal-head">
    <strong>×¡×œ×˜ ×‘×”×¨×›×‘×”</strong>
    <button class="btn link" onclick="dlgSalad.close()">×¡×’×•×¨ âœ•</button>
  </div>
  <div class="modal-body">
    <form id="saladForm">
      <div class="group">
        <h4>×’×•×“×œ ×¡×œ×˜</h4>
        <div class="options" data-name="size" data-type="radio">
          <label class="opt"><input type="radio" name="size" value="small" data-price="40"> 750 ×"×œ â€“ â‚ª40</label>
          <label class="opt"><input type="radio" name="size" value="large" data-price="46"> 1000 ×"×œ â€“ â‚ª46</label>
        </div>
      </div>
      <div class="group">
        <h4>××¨×›×™×‘×™× (×‘×—×™×¨×” ×—×•×¤×©×™×ª)</h4>
        <div class="options" data-name="ingredients" data-type="checkbox">
          <label class="opt"><input type="checkbox" value="××œ×¤×¤×•×Ÿ"> ××œ×¤×¤×•×Ÿ</label>
          <label class="opt"><input type="checkbox" value="×¢×’×‘× ×™×™×”"> ×¢×’×‘× ×™×™×”</label>
          <label class="opt"><input type="checkbox" value="×—×¡×”"> ×—×¡×”</label>
          <label class="opt"><input type="checkbox" value="×‘×¦×œ ×™×¨×•×§"> ×‘×¦×œ ×™×¨×•×§</label>
          <label class="opt"><input type="checkbox" value="×›×•×¡×‘×¨×”"> ×›×•×¡×‘×¨×”</label>
          <label class="opt"><input type="checkbox" value="×¤×˜×¨×•×–×œ×™×”"> ×¤×˜×¨×•×–×œ×™×”</label>
          <label class="opt"><input type="checkbox" value="× ×¢× ×¢"> × ×¢× ×¢</label>
          <label class="opt"><input type="checkbox" value="×‘×–×™×œ×™×§×•×"> ×‘×–×™×œ×™×§×•×</label>
          <label class="opt"><input type="checkbox" value="×¢×œ×™ ×¨×•×§×˜"> ×¢×œ×™ ×¨×•×§×˜</label>
          <label class="opt"><input type="checkbox" value="×‘×¦×œ ×¡×’×•×œ"> ×‘×¦×œ ×¡×’×•×œ</label>
          <label class="opt"><input type="checkbox" value="×¤×œ×¤×œ ×™×¨×•×§"> ×¤×œ×¤×œ ×™×¨×•×§</label>
          <label class="opt"><input type="checkbox" value="×¤×œ×¤×œ ××“×•×"> ×¤×œ×¤×œ ××“×•×</label>
          <label class="opt"><input type="checkbox" value="×¤×œ×¤×œ ×¦×”×•×‘"> ×¤×œ×¤×œ ×¦×”×•×‘</label>
          <label class="opt"><input type="checkbox" value="×›×¨×•×‘ ×œ×‘×Ÿ"> ×›×¨×•×‘ ×œ×‘×Ÿ</label>
          <label class="opt"><input type="checkbox" value="×’×–×¨"> ×’×–×¨</label>
          <label class="opt"><input type="checkbox" value="×–×™×ª×™× ×™×¨×•×§×™×"> ×–×™×ª×™× ×™×¨×•×§×™×</label>
          <label class="opt"><input type="checkbox" value="×–×™×ª×™ ×§×œ××˜×”"> ×–×™×ª×™ ×§×œ××˜×”</label>
          <label class="opt"><input type="checkbox" value="×ª×™×¨×¡"> ×ª×™×¨×¡</label>
          <label class="opt"><input type="checkbox" value="×¤×¡×˜×” ××¡×•×œ×¡×œ×ª"> ×¤×¡×˜×” ××¡×•×œ×¡×œ×ª</label>
          <label class="opt"><input type="checkbox" value="×§×™× ×•××”"> ×§×™× ×•××”</label>
          <label class="opt"><input type="checkbox" value="×¢×“×©×™× ×©×—×•×¨×•×ª"> ×¢×“×©×™× ×©×—×•×¨×•×ª</label>
          <label class="opt"><input type="checkbox" value="×’×¨×’×™×¨×™ ×—×•××•×¡"> ×’×¨×’×™×¨×™ ×—×•××•×¡</label>
          <label class="opt"><input type="checkbox" value="×‘×˜×˜×” ××¤×•×™×” ×‘×ª× ×•×¨"> ×‘×˜×˜×” ××¤×•×™×” ×‘×ª× ×•×¨</label>
          <label class="opt"><input type="checkbox" value='×ª×¤×•"× ××¤×•×™'> ×ª×¤×•"× ××¤×•×™</label>
          <label class="opt"><input type="checkbox" value="×¡×œ×§ ××¤×•×™"> ×¡×œ×§ ××¤×•×™</label>
          <label class="opt"><input type="checkbox" value="×—××•×¦×™×•×ª"> ×—××•×¦×™×•×ª</label>
          <label class="opt"><input type="checkbox" value="×©×‘×¨×™ ××’×•×–×™ ××œ×š"> ×©×‘×¨×™ ××’×•×–×™ ××œ×š</label>
          <label class="opt"><input type="checkbox" value="×’×¨×¢×™× ×™ ×—×× ×™×™×”"> ×’×¨×¢×™× ×™ ×—×× ×™×™×”</label>
          <label class="opt"><input type="checkbox" value="×’×¨×¢×™× ×™ ×“×œ×¢×ª"> ×’×¨×¢×™× ×™ ×“×œ×¢×ª</label>
        </div>
      </div>
      <div class="group">
        <h4>×ª×•×¡×¤×•×ª (××—×ª ×—×™× ×)</h4>
        <div class="options" data-name="extras" data-type="checkbox">
          <label class="opt"><input type="checkbox" value="×‘×™×¦×” ×§×©×”" data-price="3"> ×‘×™×¦×” ×§×©×” (+â‚ª3)</label>
          <label class="opt"><input type="checkbox" value="×˜×•× ×”" data-price="6"> ×˜×•× ×” (+â‚ª6)</label>
          <label class="opt"><input type="checkbox" value="×˜×•× ×” ×‘××™×•× ×–" data-price="6"> ×˜×•× ×” ×‘××™×•× ×– (+â‚ª6)</label>
          <label class="opt"><input type="checkbox" value="×’×‘×™× ×ª ×¤×˜×” 5%" data-price="5"> ×’×‘×™× ×ª ×¤×˜×” 5% (+â‚ª5)</label>
          <label class="opt"><input type="checkbox" value="×’×‘×™× ×” ×‘×•×œ×’×¨×™×ª 24%" data-price="6"> ×’×‘×™× ×” ×‘×•×œ×’×¨×™×ª 24% (+â‚ª6)</label>
          <label class="opt"><input type="checkbox" value="×˜×•×¤×•" data-price="5"> ×˜×•×¤×• (+â‚ª5)</label>
        </div>
        <div class="helper">×”×‘×—×™×¨×” ×”×™×§×¨×” ××‘×™× ×™×”×Ÿ ×ª×—×•×©×‘ ×—×™× ×.</div>
      </div>
      <div class="group">
        <h4>×¨×˜×‘×™× (2 ×›×œ×•×œ×™×, ×›×œ × ×•×¡×£ +â‚ª3)</h4>
        <div class="options" data-name="dressings" data-type="checkbox" data-free="2" data-extra-price="3">
          <label class="opt"><input type="checkbox" value="×˜×—×™× ×”"> ×˜×—×™× ×”</label>
          <label class="opt"><input type="checkbox" value="×˜×—×™× ×” ×’×•×œ××™×ª"> ×˜×—×™× ×” ×’×•×œ××™×ª</label>
          <label class="opt"><input type="checkbox" value="×©××Ÿ ×–×™×ª ×•×œ×™××•×Ÿ"> ×©××Ÿ ×–×™×ª ×•×œ×™××•×Ÿ</label>
          <label class="opt"><input type="checkbox" value="×•×™× ×™×’×¨×˜ ×”×“×¨×™×"> ×•×™× ×™×’×¨×˜ ×”×“×¨×™×</label>
          <label class="opt"><input type="checkbox" value="×¨×•×˜×‘ ×©×•×"> ×¨×•×˜×‘ ×©×•×</label>
          <label class="opt"><input type="checkbox" value="×¨×•×˜×‘ ××œ×£ ×”××™×™×"> ×¨×•×˜×‘ ××œ×£ ×”××™×™×</label>
          <label class="opt"><input type="checkbox" value="×œ×™××•×Ÿ ×˜×¨×™"> ×œ×™××•×Ÿ ×˜×¨×™</label>
        </div>
      </div>
      <div class="group">
        <h4>×œ×—× (+â‚ª4)</h4>
        <div class="options" data-name="bread" data-type="radio">
          <label class="opt"><input type="radio" name="bread" value="×œ×—× ×›×¤×¨×™" data-price="4" checked> ×œ×—× ×›×¤×¨×™ (+â‚ª4)</label>
          <label class="opt"><input type="radio" name="bread" value="×œ×—× ×“×’× ×™×" data-price="4"> ×œ×—× ×“×’× ×™× (+â‚ª4)</label>
          <label class="opt"><input type="radio" name="bread" value="×œ×—×× ×™×” ×œ×‘× ×”" data-price="4"> ×œ×—×× ×™×” ×œ×‘× ×” (+â‚ª4)</label>
        </div>
      </div>
      <div class="hr"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
        <div>××—×™×¨ ××©×•×¢×¨: <strong id="saladPrice">â‚ª0</strong></div>
        <div style="display:flex;gap:8px">
          <button type="button" class="btn ghost" onclick="dlgSalad.close()">×‘×™×˜×•×œ</button>
          <button type="submit" class="btn primary">×”×•×¡×£ ×œ×¢×’×œ×”</button>
        </div>
      </div>
    </form>
  </div>
</dialog>

<!-- Checkout -->
<dialog id="dlgCheckout" aria-label="×ª×©×œ×•× ×•××©×œ×•×—">
  <div class="modal-head">
    <strong>×ª×©×œ×•× ×•××©×œ×•×—</strong>
    <button class="btn link" onclick="dlgCheckout.close()">×¡×’×•×¨ âœ•</button>
  </div>
  <div class="modal-body">
    <form class="checkout" id="checkoutForm">
      <div class="two">
        <div class="field"><label>×©× ××œ×</label><input required type="text" name="name" placeholder="×©× ×•×©× ××©×¤×—×”"></div>
        <div class="field"><label>×˜×œ×¤×•×Ÿ</label><input required type="tel" name="phone" placeholder="050-0000000" pattern="0[0-9\\-]{8,10}"></div>
      </div>
      <div class="two">
        <div class="field"><label>××™××™×™×œ</label><input type="email" name="email" placeholder="name@example.com"></div>
        <div class="field"><label>×©×™×˜×ª ××¡×¤×§×”</label>
          <select name="deliveryMethod" id="deliveryMethod">
            <option value="pickup">××™×¡×•×£ ×¢×¦××™ (â‚ª0)</option>
            <option value="mall">××©×œ×•×— ×—×™× × (×‘××ª×—× ×”×§× ×™×•×Ÿ)</option>
            <option value="delivery">××©×œ×•×— (â‚ª15)</option>
          </select>
        </div>
      </div>
      <div id="addressFields" style="display:none">
        <div class="two">
          <div class="field"><label>×¢×™×¨</label><input type="text" name="city" placeholder="×§×¨×™×™×ª ××•× ×•"></div>
          <div class="field"><label>×›×ª×•×‘×ª</label><input type="text" name="address" placeholder="×¨×—×•×‘ ×•××¡×¤×¨"></div>
        </div>
        <div class="three">
          <div class="field"><label>×§×•××”</label><input type="text" name="floor" placeholder="4"></div>
          <div class="field"><label>××©×¨×“ / ×“×™×¨×”</label><input type="text" name="office" placeholder="9"></div>
          <div class="field"><label>×”×¢×¨×•×ª ×œ×©×œ×™×—</label><input type="text" name="notes" placeholder="×§×•×“ ×›× ×™×¡×” ×•×›×•'"></div>
        </div>
      </div>
      <div class="hr"></div>
      <div class="two">
        <div class="field"><label>××•×¤×Ÿ ×ª×©×œ×•×</label>
          <select name="payment" id="payment">
            <option value="cash">××–×•××Ÿ</option>
            <option value="card">××©×¨××™</option>
          </select>
        </div>
        <div class="field"><label>×¡×›×•× ×œ×ª×©×œ×•×</label><input type="text" id="payAmount" readonly></div>
      </div>
      <div class="hr"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div class="subtitle">×”×”×–×× ×” ×ª×™×©×œ×— ××•×˜×•××˜×™×ª ×œ××—×¨ ××™×©×•×¨</div>
        <button type="submit" class="btn primary" id="btnPlaceOrder">×‘×¦×¢ ×”×–×× ×”</button>
      </div>
    </form>
  </div>
</dialog>

<script>
/** === ×ª×¦×•×¨×” === */
const SHEET_ENDPOINT = 'https://script.google.com/macros/s/AKfycbx5tSsWpWSfxOjWsY0vNLhzGb0GJhEZo2Zb3s_wjTJsfGt_cJz7M_mPpQoQElFMmcmOUA/exec';
const DELIVERY_PRICE = { pickup: 0, mall: 0, delivery: 15 };

/** === ×ª××•× ×ª ×‘×¨×™×¨×ª ××—×“×œ (×œ×•×’×•) === */
const PH = 'data:image/svg+xml;utf8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="160"><rect width="100%" height="100%" fill="#eaf3f5"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="18" fill="#0ea5a6">Cafe Tattis</text></svg>');

/** === ×ª××•× ×•×ª ×œ×¤×™ ××–×”×” ××•×¦×¨ === */
const IMAGES = {
  greek:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-17-f9ea5fca.jpg",
  tuna:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-29-37-b867e557.jpg",
  pasta:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-17-c50de089.jpg",
  vegan:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-17-23bbe18c.jpg",
  sand_greenomelet:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-17-acd44cca.jpg",
  sand_omelet:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-17-0e958e62.jpg",
  sand_sabich:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-15-d7683a31.jpg",
  sand_tunaSalad:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-17-594ec9b2.jpg",
  sand_cheddar:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-16-491e300c.jpg",
  sand_eggSalad:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-16-44cc8424.jpg",
  sand_levivot:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-16-dee60627.jpg",
  sand_bulgarit_pesto:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-16-8a8ecd46.jpg",
  sand_salmon_smoked:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-16-f350c982.jpg",
  choc_balls_sprinkles:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-17-d7a551ad.jpg",
  choc_balls_coconut:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-11-17-d7a551ad.jpg",
  macarons:"https://cafetattis.weebly.com/uploads/1/0/3/4/10347808/whatsapp-2025-08-22-13-42-22-b166020b.jpg",
  carrot_cake:"", pritzi_cake:"", biscuit_cake:""
};

/** === ×§×˜×œ×•×’ === */
const CATALOG = [
  {id:'build', name:'×¡×œ×˜ ×‘×”×¨×›×‘×”', price:null, description:'×‘×—×¨×• ×’×•×“×œ, ××¨×›×™×‘×™×, ×ª×•×¡×¤×•×ª ×•×¨×˜×‘×™× â€“ ×œ×œ× ×©×ª×™×™×”', category:'builder', special:'builder', image:PH},
  {id:'greek', name:'×¡×œ×˜ ×™×•×•× ×™', price:53, description:'×¢×’×‘× ×™×™×”, ××œ×¤×¤×•×Ÿ, ×—×¡×”, ×–×™×ª×™ ×§×œ××˜×”, ×‘×¦×œ ×¡×’×•×œ, ×’×‘×™× ×ª ×¤×˜×” 5%', category:'salads', image:PH},
  {id:'tuna', name:'×¡×œ×˜ ×˜×•× ×”', price:57, description:'×¢×’×‘× ×™×™×”, ××œ×¤×¤×•×Ÿ, ×—×¡×”, ×‘×¦×œ ×¡×’×•×œ/×™×¨×•×§, ×ª×¤×•"× ××¤×•×™, ×˜×•× ×” ××™×•× ×–, ×¤×œ×¤×œ ××“×•×, ×‘×™×¦×”', category:'salads', image:PH},
  {id:'vegan', name:'×¡×œ×˜ ×˜×‘×¢×•× ×™', price:53, description:'×¨×•×§×˜, ×’×–×¨, ×›×¨×•×‘, ×¡×œ×§ ××¤×•×™, ×‘×˜×˜×” ××¤×•×™×”, ×§×™× ×•××”, ×¢×“×©×™× ×©×—×•×¨×•×ª, ×˜×•×¤×•', category:'salads', image:PH},

  {id:'sand_greenomelet', name:'×—×‘×™×ª×ª ×™×¨×§', price:25, description:'×—×‘×™×ª×ª ×ª×¨×“ ×•×‘×¦×œ ×™×¨×•×§ ×¢× ×’×‘×™× ×ª ×©×× ×ª, ×—×¡×” ×•××œ×¤×¤×•×Ÿ.', category:'sandwiches', image:PH},
  {id:'sand_omelet', name:'×—×‘×™×ª×” ×§×œ××¡×™×ª', price:25, description:'×—×‘×™×ª×” ×¢×¡×™×¡×™×ª ×¢× ×’×‘×™× ×ª ×©×× ×ª, ×—×¡×” ×•××œ×¤×¤×•×Ÿ.', category:'sandwiches', image:PH},
  {id:'sand_sabich', name:'×¡×‘×™×— ×—×œ×•××™', price:25, description:'×˜×—×™× ×” ×¢×“×™× ×”, ×—×¦×™×œ ××¤×•×™, ×‘×™×¦×” ×§×©×” ×•××œ×¤×¤×•×Ÿ ×—××•×¥.', category:'sandwiches', image:PH},
  {id:'sand_tunaSalad', name:'×¡×œ×˜ ×˜×•× ×” ×§×¦×•×¥', price:25, description:'×˜×•× ×” ×‘××™×•× ×–, ×’××‘×” ×§×¦×•×¦×”, ××œ×¤×¤×•×Ÿ ×—××•×¥ ×•×—×¡×” ×œ×œ×™×§.', category:'sandwiches', image:PH},
  {id:'sand_eggSalad', name:'×¡×œ×˜ ×‘×™×¦×™× ×‘×™×ª×™', price:25, description:'×‘×™×¦×™×, ×‘×¦×œ ×•×§×™×©×•× ××˜×•×’× ×™× ×§×œ×•×ª ×‘××™×•× ×–.', category:'sandwiches', image:PH},
  {id:'sand_levivot', name:'×œ×‘×™×‘×•×ª ×™×¨×§', price:35, description:'×œ×‘×™×‘×•×ª ×™×¨×§ ××˜×•×’× ×•×ª ×§×œ×•×ª ×¢× ×˜×—×™× ×” ×¢×“×™× ×”.', category:'sandwiches', image:PH},
  {id:'sand_bulgarit_pesto', name:'×‘×•×œ×’×¨×™×ª ×¢× ×¤×¡×˜×•', price:35, description:'×’×‘×™× ×” ×‘×•×œ×’×¨×™×ª 24%, ×¤×¡×˜×•, ×—×¡×”, ×¢×’×‘× ×™×™×” ×•×‘×–×™×œ×™×§×•×.', category:'sandwiches', image:PH},
  {id:'sand_salmon_smoked', name:'×›×¨×™×š ×¡×œ××•×Ÿ ××¢×•×©×Ÿ', price:35, description:'×¡×œ××•×Ÿ ××¢×•×©×Ÿ, ×’×‘×™× ×ª ×©×× ×ª, ×—×¡×” ×•××œ×¤×¤×•×Ÿ.', category:'sandwiches', image:PH},

  {id:'choc_balls_sprinkles', name:'×××¨×– 3 ×›×“×•×¨×™ ×©×•×§×•×œ×“ â€“ ×¦×™×¤×•×™ ×¡×•×›×¨×™×•×ª', price:15, description:'×›×“×•×¨×™ ×©×•×§×•×œ×“ ×‘×¦×™×¤×•×™ ×¡×•×›×¨×™×•×ª', category:'desserts', image:PH},
  {id:'choc_balls_coconut', name:'×××¨×– 3 ×›×“×•×¨×™ ×©×•×§×•×œ×“ â€“ ×¦×™×¤×•×™ ×§×•×§×•×¡', price:15, description:'×›×“×•×¨×™ ×©×•×§×•×œ×“ ×‘×¦×™×¤×•×™ ×§×•×§×•×¡', category:'desserts', image:PH},
  {id:'macarons', name:'×××¨×– ×¢×•×’×™×•×ª ××§×¨×•×Ÿ', price:29, description:'××‘×—×¨ ×˜×¢××™×', category:'desserts', image:PH},
  {id:'carrot_cake', name:'×¢×•×’×ª ×’×–×¨', price:38, description:'×¢×•×’×ª ×¤×¡ ×©×œ××”', category:'desserts', image:PH},
  {id:'pritzi_cake', name:'×¢×•×’×ª ×¤×¨×™×¦×™', price:38, description:'×¢×•×’×ª ×¤×¡ ×©×œ××”', category:'desserts', image:PH},
  {id:'biscuit_cake', name:'×¢×•×’×ª ×‘×™×¡×§×•×•×™×˜×™×', price:42, description:'×¢×•×’×ª ×¤×¡ ×©×œ××”', category:'desserts', image:PH},

  // Drinks â€“ ×œ×œ× ×ª××•× ×•×ª
  {id:'drink_xl', name:'XL', price:10, description:'×¤×—×™×ª', category:'drinks', noImage:true},
  {id:'drink_grape_can', name:'×¤×—×™×ª ××™×¥ ×¢× ×‘×™×', price:10, description:'×¤×—×™×ª', category:'drinks', noImage:true},
  {id:'drink_peach_can', name:'×¤×—×™×ª ××™×¥ ××¤×¨×¡×§', price:10, description:'×¤×—×™×ª', category:'drinks', noImage:true},
  {id:'drink_cola_bottle', name:'×§×•×§×” ×§×•×œ×” 0.5 ×œ×³ ×‘×§×‘×•×§', price:12, description:'×‘×§×‘×•×§ 500 ××´×œ', category:'drinks', noImage:true},
  {id:'drink_cola_zero_bottle', name:'×§×•×§×” ×§×•×œ×” ×–×™×¨×• 0.5 ×œ×³ ×‘×§×‘×•×§', price:12, description:'×‘×§×‘×•×§ 500 ××´×œ', category:'drinks', noImage:true},
  {id:'drink_cola_can', name:'×¤×—×™×ª ×§×•×§×” ×§×•×œ×”', price:10, description:'330 ××´×œ', category:'drinks', noImage:true},
  {id:'drink_cola_zero_can', name:'×¤×—×™×ª ×§×•×§×” ×§×•×œ×” ×–×™×¨×•', price:10, description:'330 ××´×œ', category:'drinks', noImage:true},
  {id:'drink_sprite_can', name:'×¤×—×™×ª ×¡×¤×¨×™×™×˜', price:10, description:'330 ××´×œ', category:'drinks', noImage:true},
  {id:'drink_sprite_zero_can', name:'×¤×—×™×ª ×¡×¤×¨×™×™×˜ ×–×™×¨×•', price:10, description:'330 ××´×œ', category:'drinks', noImage:true},
  {id:'drink_soda', name:'×¡×•×“×”', price:9, description:'×‘×§×‘×•×§', category:'drinks', noImage:true},
  {id:'drink_flavored_peach', name:'××™× ×‘×˜×¢× ××¤×¨×¡×§', price:10, description:'×‘×§×‘×•×§', category:'drinks', noImage:true},
  {id:'drink_flavored_apple', name:'××™× ×‘×˜×¢× ×ª×¤×•×—', price:10, description:'×‘×§×‘×•×§', category:'drinks', noImage:true},
  {id:'drink_flavored_grape', name:'××™× ×‘×˜×¢× ×¢× ×‘×™×', price:10, description:'×‘×§×‘×•×§', category:'drinks', noImage:true},
  {id:'drink_prigat_grapefruit', name:'××™×¥ ××©×›×•×œ×™×•×ª ×¤×¨×™×’×ª', price:10, description:'×‘×§×‘×•×§/×¤×—×™×ª', category:'drinks', noImage:true},
  {id:'drink_nestea_500', name:'× ×¡×˜×™ 0.5 ×œ×³', price:10, description:'×‘×§×‘×•×§ 500 ××´×œ', category:'drinks', noImage:true},
  {id:'drink_mey_eden', name:'××™ ×¢×“×Ÿ', price:10, description:'×‘×§×‘×•×§', category:'drinks', noImage:true},
  {id:'drink_neviot', name:'××™ × ×‘×™×¢×•×ª', price:10, description:'×‘×§×‘×•×§', category:'drinks', noImage:true},
  {id:'fresh_orange', name:'×¡×—×•×˜ ×˜×¨×™ ×ª×¤×•×– 250 ××´×œ', price:16, description:'××™×¥ ×¡×—×•×˜ ×˜×¨×™', category:'drinks', noImage:true},
  {id:'fresh_pomegranate', name:'×¡×—×•×˜ ×˜×¨×™ ×¨×™××•×Ÿ 250 ××´×œ', price:16, description:'××™×¥ ×¡×—×•×˜ ×˜×¨×™', category:'drinks', noImage:true},
  {id:'fresh_matcha_spirulina', name:'×¡×—×•×˜ ×˜×¨×™ ×××¦×³×” ×¡×¤×™×¨×•×œ×™× ×” 250 ××´×œ', price:16, description:'××™×¥ ×¡×—×•×˜ ×˜×¨×™', category:'drinks', noImage:true},
  {id:'fresh_carrot', name:'×¡×—×•×˜ ×˜×¨×™ ×’×–×¨ 250 ××´×œ', price:16, description:'××™×¥ ×¡×—×•×˜ ×˜×¨×™', category:'drinks', noImage:true},
  {id:'fresh_apple', name:'×¡×—×•×˜ ×˜×¨×™ ×ª×¤×•×— 250 ××´×œ', price:16, description:'××™×¥ ×¡×—×•×˜ ×˜×¨×™', category:'drinks', noImage:true},
  {id:'fresh_lemonade', name:'×¡×—×•×˜ ×˜×¨×™ ×œ×™××•× ×“×” 250 ××´×œ', price:16, description:'××™×¥ ×¡×—×•×˜ ×˜×¨×™', category:'drinks', noImage:true},
];

const state = { cart: [], deliveryMethod:'pickup' };
const el = (s)=>document.querySelector(s);
const elCartItems = el('#cartItems');
const elSubTotal = el('#subTotal');
const elDeliveryFee = el('#deliveryFee');
const elGrandTotal = el('#grandTotal');
const ils = (n)=>'â‚ª'+(n.toFixed(0));
const save = ()=> localStorage.setItem('tattis_cart', JSON.stringify(state));
const load = ()=> { try{ Object.assign(state, JSON.parse(localStorage.getItem('tattis_cart'))||{});}catch{} renderCart(); };
const sameMeta = (a,b)=> JSON.stringify(a||{})===JSON.stringify(b||{});

function addToCart(item){
  const i = state.cart.findIndex(x=> x.id===item.id && sameMeta(x.meta,item.meta));
  if(i>-1) state.cart[i].qty += item.qty||1; else state.cart.push({...item, qty:item.qty||1});
  renderCart(); save();
}
function removeFromCart(idx){ state.cart.splice(idx,1); renderCart(); save(); }
function changeQty(idx,delta){ const it=state.cart[idx]; if(!it) return; it.qty=Math.max(1,it.qty+delta); renderCart(); save(); }
function totals(){
  const sub = state.cart.reduce((s,it)=>s+it.price*it.qty,0);
  const delivery = state.deliveryMethod==='delivery' ? DELIVERY_PRICE.delivery : 0;
  const total = Math.max(0, sub+delivery);
  return {sub,delivery,total};
}
function metaText(m){
  if(!m) return '';
  const p=[];
  if(m.size) p.push(`×’×•×“×œ: ${m.size==='small'?'750 ×"×œ':'1000 ×"×œ'}`);
  if(m.ingredients?.length) p.push(`××¨×›×™×‘×™×: ${m.ingredients.join(', ')}`);
  if(m.extras?.length) p.push(`×ª×•×¡×¤×•×ª: ${m.extras.join(', ')}`);
  if(m.dressings?.length) p.push(`×¨×˜×‘×™×: ${m.dressings.join(', ')}`);
  if(m.bread) p.push(`×œ×—×: ${m.bread}`);
  return p.join(' | ');
}
function renderCart(){
  elCartItems.innerHTML='';
  if(state.cart.length===0){ elCartItems.innerHTML = '<div class="subtitle" style="padding:8px 2px">×”×¢×’×œ×” ×¨×™×§×”. ×”×•×¡×™×¤×• ×¤×¨×™×˜×™× ××”×ª×¤×¨×™×˜ â†’</div>'; }
  state.cart.forEach((it,i)=>{
    const row=document.createElement('div'); row.className='cart-row';
    row.innerHTML = `
      <div class="qty">
        <button aria-label="×”×¤×—×ª" onclick="changeQty(${i},-1)">â€“</button>
        <div>${it.qty}</div>
        <button aria-label="×”×•×¡×£" onclick="changeQty(${i},+1)">+</button>
      </div>
      <div>
        <div style="font-weight:800">${it.name}</div>
        ${it.meta?`<div class="subtitle" style="font-size:12px">${metaText(it.meta)}</div>`:''}
      </div>
      <div style="text-align:end">
        <div>${ils(it.price*it.qty)}</div>
        <button class="btn link" onclick="removeFromCart(${i})">×”×¡×¨</button>
      </div>`;
    elCartItems.appendChild(row);
  });
  const t=totals();
  elSubTotal.textContent = ils(t.sub);
  elDeliveryFee.textContent = ils(t.delivery);
  elGrandTotal.textContent = ils(t.total);
  document.getElementById('payAmount')?.value && (document.getElementById('payAmount').value = ils(t.total));
}

function makeCard(p){
  const wrap = document.createElement('div');
  wrap.className='card' + (p.noImage ? ' no-thumb' : '');
  const isBuilder = p.special==='builder';
  const imgSrc = p.noImage ? '' : (IMAGES[p.id] || p.image || PH);
  wrap.innerHTML = `
    ${p.noImage ? '' : `<div class="thumb"><img alt="${p.name}" src="${imgSrc}"></div>`}
    <div class="card-body">
      <h3>${p.name}</h3>
      <p>${p.description||''}</p>
      <div class="actions">
        <div class="price">${p.price? ils(p.price) : ''}</div>
        <button class="btn ${isBuilder ? 'ghost' : 'primary'}" ${isBuilder ? 'data-builder="1"' : `data-id="${p.id}"`}>
          ${isBuilder ? '×¤×ª×— ××¤×©×¨×•×™×•×ª' : '×”×•×¡×£'}
        </button>
      </div>
    </div>`;
  return wrap;
}
function renderCategories(){
  const saladsGrid = document.getElementById('grid-salads');
  const sandwichesGrid = document.getElementById('grid-sandwiches');
  const dessertsGrid = document.getElementById('grid-desserts');
  const drinksGrid = document.getElementById('grid-drinks');
  saladsGrid.innerHTML=''; sandwichesGrid.innerHTML=''; dessertsGrid.innerHTML=''; drinksGrid.innerHTML='';
  saladsGrid.appendChild(makeCard(CATALOG.find(x=>x.special==='builder')));
  CATALOG.filter(x=>x.category==='salads').forEach(p=> saladsGrid.appendChild(makeCard(p)));
  CATALOG.filter(x=>x.category==='sandwiches').forEach(p=> sandwichesGrid.appendChild(makeCard(p)));
  CATALOG.filter(x=>x.category==='desserts').forEach(p=> dessertsGrid.appendChild(makeCard(p)));
  CATALOG.filter(x=>x.category==='drinks').forEach(p=> drinksGrid.appendChild(makeCard(p)));
  document.querySelectorAll('[data-builder]').forEach(btn=> btn.addEventListener('click', ()=> dlgSalad.showModal()));
  document.querySelectorAll('button[data-id]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const it = CATALOG.find(x=>x.id===btn.dataset.id);
      addToCart({id:it.id, name:it.name, price:it.price});
    });
  });
}

// Builder pricing
const dlgSalad = document.getElementById('dlgSalad');
const saladForm = document.getElementById('saladForm');
const saladPriceEl = document.getElementById('saladPrice');
function calcSaladPrice(){
  let price=0;
  const sizeEl = saladForm.querySelector('input[name="size"]:checked');
  if(sizeEl) price += Number(sizeEl.dataset.price||0);
  const extrasWrap = saladForm.querySelector('[data-name="extras"]');
  if(extrasWrap){
    const chosen=[...extrasWrap.querySelectorAll('input:checked')];
    if(chosen.length){
      const vals = chosen.map(i=>Number(i.dataset.price||0));
      const sum = vals.reduce((a,b)=>a+b,0);
      const max = Math.max(...vals);
      price += (sum - max);
    }
  }
  const dWrap = saladForm.querySelector('[data-name="dressings"]');
  const free = Number(dWrap?.dataset.free||2), add = Number(dWrap?.dataset.extraPrice||3);
  const count = saladForm.querySelectorAll('[data-name="dressings"] input:checked').length;
  price += Math.max(0, count - free) * add;
  const breadEl = saladForm.querySelector('input[name="bread"]:checked');
  if(breadEl){ price += Number(breadEl.dataset.price||0); }
  saladPriceEl.textContent = ils(price);
  return price;
}
function collectSalad(){
  const meta={
    size:(saladForm.querySelector('input[name="size"]:checked')||{}).value,
    ingredients:[...saladForm.querySelectorAll('[data-name="ingredients"] input:checked')].map(x=>x.value),
    extras:[...saladForm.querySelectorAll('[data-name="extras"] input:checked')].map(x=>x.value),
    dressings:[...saladForm.querySelectorAll('[data-name="dressings"] input:checked')].map(x=>x.value),
    bread:(saladForm.querySelector('input[name="bread"]:checked')||{}).value,
  };
  const price=calcSaladPrice();
  return { id:'custom-'+JSON.stringify(meta), name:'×¡×œ×˜ ×‘×”×¨×›×‘×”', price, meta };
}
document.querySelectorAll('.options').forEach(g=>{
  g.addEventListener('change',()=>{
    g.querySelectorAll('.opt').forEach(o=>{
      const i=o.querySelector('input');
      o.classList.toggle('active', i.type==='radio'? i.checked : i.checked);
    });
    calcSaladPrice();
  })
});
saladForm.addEventListener('submit',e=>{
  e.preventDefault();
  if(!saladForm.querySelector('input[name="size"]:checked')){ alert('×‘×—×¨×• ×’×•×“×œ ×¡×œ×˜'); return; }
  addToCart(collectSalad()); saladForm.reset();
  document.querySelectorAll('.opt').forEach(o=>o.classList.remove('active'));
  saladPriceEl.textContent='â‚ª0'; dlgSalad.close();
});

// Checkout
const dlgCheckout = document.getElementById('dlgCheckout');
const checkoutForm = document.getElementById('checkoutForm');
const deliveryEl = document.getElementById('deliveryMethod');
const addressFields = document.getElementById('addressFields');
const paymentEl = document.getElementById('payment');
function openCheckout(){ if(state.cart.length===0){ alert('×”×¢×’×œ×” ×¨×™×§×”'); return;} document.getElementById('payAmount').value = ils(totals().total); dlgCheckout.showModal(); }
document.getElementById('btnCheckout').addEventListener('click', openCheckout);
document.getElementById('btnCheckoutHeader').addEventListener('click', openCheckout);
document.getElementById('btnBuildSalad').addEventListener('click', ()=> dlgSalad.showModal());
document.getElementById('btnClearCart').addEventListener('click', ()=>{ if(confirm('×œ× ×§×•×ª ××ª ×”×¢×’×œ×”?')){ state.cart=[]; renderCart(); save(); }});
deliveryEl.addEventListener('change', ()=>{
  state.deliveryMethod = deliveryEl.value;
  addressFields.style.display = (state.deliveryMethod==='mall' || state.deliveryMethod==='delivery')? '' : 'none';
  const t=totals();
  document.getElementById('payAmount').value = ils(t.total);
  document.getElementById('deliveryFee').textContent = ils(t.delivery);
  document.getElementById('grandTotal').textContent = ils(t.total);
});
paymentEl.addEventListener('change', ()=>{ /* ×©×“×•×ª ××©×¨××™ ×œ× × ×©×œ×—×™× */ });

checkoutForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = new FormData(checkoutForm);
  const customer = {
    name: f.get('name')||'',
    phone: f.get('phone')||'',
    email: f.get('email')||'',
    city: f.get('city')||'',
    address: f.get('address')||'',
    floor: f.get('floor')||'',
    office: f.get('office')||'',
    notes: f.get('notes')||'',
    payment: f.get('payment')||'cash'
  };
  const t = totals();
  const payload = {
    meta:{ ts:new Date().toISOString(), source:'weebly-frontend-v2' },
    customer,
    deliveryMethod: state.deliveryMethod,
    items: state.cart.map(it=>({id:it.id,name:it.name,qty:it.qty,price:it.price,meta:it.meta||null})),
    totals:{ sub: t.sub, delivery: t.delivery, total: t.total }
  };

  const btn = document.getElementById('btnPlaceOrder');
  btn.disabled = true; btn.textContent = '×©×•×œ×—...';

  try {
    const res = await fetch(SHEET_ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain; charset=utf-8' }, // ××•× ×¢ preflight/CORS
      body: JSON.stringify(payload),
      mode: 'cors',
      cache: 'no-store'
    });

    // ×× ×”×ª×’×•×‘×” ×–××™× ×” ×œ×§×¨×™××” â€“ ×‘×“×™×§×ª JSON
    if (res.type === 'basic' || res.type === 'cors') {
      const data = await res.json().catch(()=> ({}));
      if (!res.ok || data.ok !== true) throw new Error((data && data.error) || '×©×’×™××” ×‘×©×œ×™×—×”');
    }

    alert('×”×–×× ×” ×”×ª×§×‘×œ×”! ×ª×•×“×” ğŸ™');
    state.cart = []; renderCart(); save();
    checkoutForm.reset(); addressFields.style.display='none'; dlgCheckout.close();

  } catch (err) {
    alert('×œ× × ×™×ª×Ÿ ×œ×©×œ×•×— ×›×¨×’×¢: ' + err.message);
  } finally {
    btn.disabled = false; btn.textContent = '×‘×¦×¢ ×”×–×× ×”';
  }
});

(function init(){ renderCategories(); load(); })();
</script>
</body>
</html>
